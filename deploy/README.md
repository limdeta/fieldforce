# FieldForce Deployment Scripts

–°–∫—Ä–∏–ø—Ç—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π FieldForce –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω —Å–µ—Ä–≤–µ—Ä.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

### –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏:

1. **–í–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥** –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∏—Ö –ª–æ–∫–∞–ª—å–Ω–æ
2. **–û–±–Ω–æ–≤–∏—Ç–µ –≤–µ—Ä—Å–∏—é –≤ `pubspec.yaml`** (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å `1.0.0` –Ω–∞ `1.0.1`)
3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é** (—Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π —Ä–∞–∑):
   ```bash
   cd deploy
   cp .env.example .env
   # –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à SERVER_USER
   ```
4. **–°–æ–±–µ—Ä–∏—Ç–µ –∏ –∑–∞–¥–µ–ø–ª–æ–π—Ç–µ –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é**:
   ```bash
   # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π
   dart deploy_update.dart "üöÄ –û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —ç—Ç–æ–π –≤–µ—Ä—Å–∏–∏"
   
   # –ò–ª–∏ –ø–æ—à–∞–≥–æ–≤–æ:
   dart deploy_update.dart --show-commands "üöÄ –û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π"
   # –í—ã–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–∫–∞–∑–∞–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –≤—Ä—É—á–Ω—É—é
   ```
5. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ–ª—É—á–∞—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏!

### ‚ö° –ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å —Å–æ–±—Ä–∞–Ω–Ω—ã–π APK:
```bash
dart deploy_update.dart --skip-build "üöÄ –û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π"
```

### üõ†Ô∏è –ï—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å SSH:
```bash
dart deploy_update.dart --show-commands "üöÄ –û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π"
# –í—ã–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–∫–∞–∑–∞–Ω–Ω—ã–µ scp –∫–æ–º–∞–Ω–¥—ã –≤—Ä—É—á–Ω—É—é
```

---

## üìã –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –ß—Ç–æ –¥–µ–ª–∞—é—Ç —Å–∫—Ä–∏–ø—Ç—ã

1. **–°–±–æ—Ä–∫–∞ APK**: `flutter build apk --release --dart-define=ENV=prod`
2. **–°–æ–∑–¥–∞–Ω–∏–µ metadata**: –ì–µ–Ω–µ—Ä–∏—Ä—É—é—Ç `update-info.json` —Å changelog
3. **–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä**: 
   - APK ‚Üí `/var/www/mobile-app/releases/`
   - Metadata ‚Üí `/var/www/mobile-app/update-info.json`
4. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏**: POST –∫ `/v1_api/mobile-sync/app/refresh`
5. **–û—á–∏—Å—Ç–∫–∞**: –£–¥–∞–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

#### PowerShell (Windows):
```powershell
.\deploy-update.ps1 "1.2.0" "üöÄ –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ —Ç–æ–≤–∞—Ä–æ–≤"
```

#### Dart (–∫—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ):
```bash
# –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –≤–µ—Ä—Å–∏–∏ –∏ changelog
dart deploy_update.dart "1.2.0" "üöÄ –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ —Ç–æ–≤–∞—Ä–æ–≤"

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–µ—Ä—Å–∏—è –∏–∑ pubspec.yaml
dart deploy_update.dart "üöÄ –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ —Ç–æ–≤–∞—Ä–æ–≤"

# –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Å–±–æ—Ä–∫—É (–µ—Å–ª–∏ APK —É–∂–µ —Å–æ–±—Ä–∞–Ω)
dart deploy_update.dart --skip-build "üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫"

# –¢–æ–ª—å–∫–æ –ø–æ–∫–∞–∑–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
dart deploy_update.dart --show-commands "‚ú® –£–ª—É—á—à–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞"

# –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω –≤–≤–æ–¥ –ø–∞—Ä–æ–ª—è)
dart deploy_update.dart --interactive "üé® –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∏–∑–∞–π–Ω–∞"
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
deploy/
‚îú‚îÄ‚îÄ deploy_update.dart      # üéØ –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç (Dart)
‚îú‚îÄ‚îÄ deploy-update.ps1       # üîß PowerShell –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞  
‚îú‚îÄ‚îÄ .env                    # üîê –í–∞—à–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–ù–ï –≤ git)
‚îú‚îÄ‚îÄ .env.example           # üìù –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ releases/              # üì± –°–æ–±—Ä–∞–Ω–Ω—ã–µ APK —Ñ–∞–π–ª—ã
‚îÇ   ‚îî‚îÄ‚îÄ fieldforce-v*.apk  # (–≤—Ä–µ–º–µ–Ω–Ω—ã–µ, —É–¥–∞–ª—è—é—Ç—Å—è –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è)
‚îú‚îÄ‚îÄ update-info.json       # üìÑ Metadata —Å changelog (–≤—Ä–µ–º–µ–Ω–Ω—ã–π)
‚îî‚îÄ‚îÄ README.md              # üìñ –≠—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –∏–∑ –ø—Ä–∏–º–µ—Ä–∞:
```bash
cp .env.example .env
```

–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ `.env`:
```properties
# –°–µ—Ä–≤–µ—Ä
SERVER_HOST=api.instock-dv.ru
SERVER_USER=–≤–∞—à-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
SERVER_PATH=/var/www/mobile-app

# –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å  
UPDATE_SECRET=frozenseaoverganimede
```

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Flutter SDK** (–¥–ª—è —Å–±–æ—Ä–∫–∏ APK)
- **SSH –¥–æ—Å—Ç—É–ø** –∫ —Å–µ—Ä–≤–µ—Ä—É (–∫–ª—é—á–∏ –∏–ª–∏ –ø–∞—Ä–æ–ª—å)
- **SCP** (OpenSSH –∏–ª–∏ Git for Windows)
- **Dart** (–≤—Ö–æ–¥–∏—Ç –≤ Flutter SDK)

### API Endpoints

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –¥–æ—Å—Ç—É–ø–Ω—ã:

- **üìã Version API**: `https://api.instock-dv.ru/v1_api/mobile-sync/app/version`
- **üì• Download**: `https://www.instock-dv.ru/v1_api/mobile-sync/app/download/fieldforce-v1.2.0.apk`
- **üîÑ Refresh**: `POST https://api.instock-dv.ru/v1_api/mobile-sync/app/refresh`

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ `.env` —Ñ–∞–π–ª–∞—Ö (–Ω–µ –≤ git)
- ‚úÖ –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è API –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–µ—Ä—Å–∏–π –∏ —Ñ–∞–π–ª–æ–≤
- ‚úÖ –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞**: –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö)
2. **–†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞**: –ß–µ—Ä–µ–∑ –º–µ–Ω—é "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è"  
3. **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π**: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å–≤–æ—é –≤–µ—Ä—Å–∏—é —Å API
4. **–î–∏–∞–ª–æ–≥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç changelog –∏ –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
5. **Android**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ APK
6. **–î—Ä—É–≥–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã**: –û—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Å—ã–ª–∫—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ

### Troubleshooting

**üîß APK –Ω–µ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è:**
```bash
flutter clean
flutter pub get
dart deploy_update.dart
```

**üîß SSH –∑–∞–≤–∏—Å–∞–µ—Ç:**
```bash
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∂–∏–º –ø–æ–∫–∞–∑–∞ –∫–æ–º–∞–Ω–¥
dart deploy_update.dart --show-commands "–æ–ø–∏—Å–∞–Ω–∏–µ"
# –í—ã–ø–æ–ª–Ω–∏—Ç–µ scp –∫–æ–º–∞–Ω–¥—ã –≤—Ä—É—á–Ω—É—é
```

**üîß –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–∞–≤–∞–º–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:**
```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
sudo usermod -a -G www-data –≤–∞—à-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
sudo chmod 664 /var/www/mobile-app/update-info.json
```

**üîß –ö–æ–¥–∏—Ä–æ–≤–∫–∞ –≤ changelog:**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ UTF-8 –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
- –≠–º–æ–¥–∑–∏ –∏ –∫–∏—Ä–∏–ª–ª–∏—Ü–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è ‚ú®üöÄ

---

## üéâ –ì–æ—Ç–æ–≤–æ!

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å –≤–∞—à–∏–º changelog!